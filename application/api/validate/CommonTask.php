<?phpnamespace app\api\validate;use app\common\model\User;use app\common\model\TaskFlow;use think\Validate;class CommonTask extends Validate{    protected $rule = [        'user_id'=> 'require|checkUserExist',        'task_id'=> 'require',        'process_id'=> 'require',        'used_time'=> 'require',    ];    protected $message = [        'user_id.require' => '用户id不能为空',        'task_id.require' => '任务id不能为空',        'process_id.require' => '工序id不能为空',        'used_time.require' => '已用时间不能为空',    ];    protected $scene = [        //首次领取任务(三个部门)        'one'=>[            'user_id'=> 'require|checkUserExist|checkUserDepart',            'task_id'        ],        //确认领取任务        'affirm'=>[            'user_id',            'task_id',            'process_id',        ],        //完成任务        'finish'=>[            'user_id',            'task_id',            'process_id',        ],        //任务超时        'over'=>[            'task_id',            'process_id',            'used_time',        ],        //指令文档        'document'=>[            'task_id',        ],    ];    //验证用户id是否存在    protected function checkUserExist($value)    {        $user = new User();        $res = $user->where(['id'=>$value])->value('id');        if (!$res)            return '用户id不存在';        return true;    }    //验证用户部门是否正确    protected function checkUserDepart($value)    {        $user = new User();        $depart = $user->where(['id'=>$value])->value('department_id');        if (!in_array($depart,[4,5,6]))            return '用户无此权限';        return true;    }    //验证任务是否被领取    protected function checkTaskStatus($value)    {        $user = new User();        $model = new TaskFlow();        $depart = $user->where(['id'=>$value])->value('department_id');        if ($depart == 4){//安质部            $user_id = $model->where(['task_id'=>$value])->value('quality_id');        }else if ($depart == 5){            $user_id = $model->where(['task_id'=>$value])->value('lab_id');        }else if ($depart == 6){            $user_id = $model->where(['task_id'=>$value])->value('machine_id');        }        if ($user_id != 0)            return '该任务已被领取';        return true;    }}