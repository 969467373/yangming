<?phpnamespace app\api\validate;use app\common\model\User;use app\common\model\MakeBeam as MakeBeamModel;use think\Validate;class MakeBeam extends Validate{    protected $rule = [        'id'=> 'require',        'user_id'=> 'require|checkUserExist',        'task_id'=> 'require',        'title'=> 'require',        'cross_hole'=> 'require',        'bridge_number'=> 'require',        'bridge_model'=> 'require',        'design_number'=> 'require',        'contact_pillar'=> 'require',        'anchor_prop'=> 'require',        'sound_barrier'=> 'require',        'settlement_marker'=> 'require',        'bearing_type'=> 'require',        'centralized_drainage'=> 'require',        'cable_bridge'=> 'require',        'mould_id'=> 'require',//胎具id        'strap_pattern'=> 'require',//胎具        'bearing_fixed'=> 'require',        //审核        'check_status'=> 'require|number',        'explain'=> 'require',    ];    protected $message = [        'id.require' => '制梁通知单id不能为空',        'user_id.require' => '用户id不能为空',        'task_id.require' => '任务id不能为空',        'task_id.unique' => '任务id已存在',        'title.require' => '任务名不能为空',        'cross_hole.require' => '孔跨不能为空',        'bridge_number.require' => '梁号不能为空',        'bridge_model.require' => '梁型不能为空',        'design_number.require' => '设计图号不能为空',        'contact_pillar.require' => '接触网支柱不能为空',        'anchor_prop.require' => '拉线支柱不能为空',        'sound_barrier.require' => '有无声屏障不能为空',        'settlement_marker.require' => '有无沉降观测标不能为空',        'bearing_type.require' => '支座类型不能为空',        'centralized_drainage.require' => '集中排水不能为空',        'cable_bridge.require' => '电缆上桥不能为空',        'mould_id.require' => '胎具id不能为空',        'strap_pattern.require' => '钢筋绑扎胎具不能为空',        'bearing_fixed.require' => '支座固定端不能为空',        //审核        'check_status.require' => '审核状态不能为空',        'check_status.number' => '审核状态必须为数字',        'explain.require' => '驳回原因不能为空',    ];    protected $scene = [        //发布制梁通知单        'add'=>[            'user_id',            'task_id'=>[                'require',                'unique'=>'make_beam',            ],            'title',            'cross_hole',            'bridge_number',            'bridge_model',            'design_number',            'contact_pillar',            'anchor_prop',            'sound_barrier',            'settlement_marker',            'bearing_type',            'centralized_drainage',            'cable_bridge',            'mould_id',            'strap_pattern',            'bearing_fixed',        ],        //修改制梁通知单        'edit'=>[            'id',            'user_id',            'task_id',            'title',            'cross_hole',            'bridge_number',            'bridge_model',            'design_number',            'contact_pillar',            'anchor_prop',            'sound_barrier',            'settlement_marker',            'bearing_type',            'centralized_drainage',            'cable_bridge',            'strap_pattern',            'bearing_fixed',        ],        //查看        'lookBeam'=>[            'user_id',            'task_id',        ],        //审核        'check'=>[            'id',            'user_id',            'task_id'=>'require|checkTaskStatus',            'check_status',            'explain',        ],    ];    //验证用户id是否存在    protected function checkUserExist($value)    {        $user = new User();        $res = $user->where(['id'=>$value])->value('id');        if (!$res)            return '用户id不存在';        return true;    }    //验证任务状态    protected function checkTaskStatus($value)    {        $model = new MakeBeamModel();        $status = $model->where(['id'=>$value])->value('check_status');        if ($status == 1)            return '该任务已通过审核';        return true;    }}