<?phpnamespace app\api\validate;use app\common\model\User;use think\Validate;class ConcretePouring extends Validate{    protected $rule = [        'id'=>'require',        'user_id'=> 'require|checkUserExist|checkUserDepart',        'task_id'=> 'require',        'section_name'=> 'require',        'pedestal_number'=> 'require',        'serial_number'=> 'require',        'project_name'=> 'require',        'company'=> 'require',        'request_date'=> 'require',        'pour_part'=> 'require',        'pour_date'=> 'require',        'plan_pour_date'=> 'require',        'plan_volume'=> 'require',        'plan_duration'=> 'require',        'transport_type'=> 'require',        'strength_grade'=> 'require',        'slump'=> 'require',        'live_cargo'=> 'require',        'field_technician'=> 'require',        'phone'=> 'require',    ];    protected $message = [        'id.require' => '浇筑表id不能为空',        'user_id.require' => '用户id不能为空',        'task_id.require' => '任务id不能为空',        'task_id.unique' => '任务id已存在',        'section_name.require' => '标段名称不能为空',        'pedestal_number.require' => '台座号不能为空',        'serial_number.require' => '编号不能为空',        'project_name.require' => '单位工程不能为空',        'company.require' => '施工单位不能为空',        'request_date.require' => '申请日期不能为空',        'pour_part.require' => '浇筑部位不能为空',        'pour_date.require' => '浇筑日期不能为空',        'plan_pour_date.require' => '计划浇筑时间不能为空',        'plan_volume.require' => '计划方量不能为空',        'plan_duration.require' => '计划用时不能为空',        'transport_type.require' => '运送方式不能为空',        'strength_grade.require' => '强度等级不能为空',        'slump.require' => '坍落度不能为空',        'live_cargo.require' => '现场砼负责人不能为空',        'field_technician.require' => '现场技术员不能为空',        'phone.require' => '电话不能为空',    ];    protected $scene = [        //获取参数        'get'=>[            'user_id',            'task_id',        ],        //获取参数        'look'=>[            'user_id'=>'require|checkUserExist',            'task_id',        ],        //发布浇筑指令        'add'=>[            'user_id',            'task_id'=>[                'require',                'unique'=>'concrete_pouring',            ],            //'section_name',            'pedestal_number',            //'serial_number',            'project_name',            'company',            'request_date',            'pour_part',            'plan_volume',            'plan_duration',            'transport_type',            'strength_grade',            //'slump',            'live_cargo',            'field_technician',            'phone',        ],        //修改浇筑指令        'edit'=>[            'id',            'user_id',            //'section_name',            'pedestal_number',            //'serial_number',            'project_name',            'company',            'request_date',            'pour_part',            'plan_volume',            'plan_duration',            'transport_type',            'strength_grade',            //'slump',            'live_cargo',            'field_technician',            'phone',        ],    ];    //验证用户id是否存在    protected function checkUserExist($value)    {        $user = new User();        $res = $user->where(['id'=>$value])->value('id');        if (!$res)            return '用户id不存在';        return true;    }    //验证用户部门是否正确    protected function checkUserDepart($value)    {        $user = new User();        $depart = $user->where(['id'=>$value])->value('department_id');        if ($depart != 1)            return '用户无此权限';        return true;    }}